<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LoRaMAC: Porting Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="loraalliance-stackforce-semtech.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LoRaMAC
   &#160;<span id="projectnumber">4.4.0</span>
   </div>
   <div id="projectbrief">Documentation of the API</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_p_o_r_t_i_n_g__g_u_i_d_e.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Porting Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#REPOSITORY_STRUCTURE">Repository Structure</a></li>
<li class="level1"><a href="#PORTING_PLATFORM">Porting To Another Hardware Platform</a></li>
<li class="level1"><a href="#RXWINDOWS">RX Window Calculation</a></li>
<li class="level1"><a href="#RXWINDOWS_CALIBRATION">RX Window Calibration</a></li>
</ul>
</div>
<div class="textblock"><hr/>
<h1><a class="anchor" id="REPOSITORY_STRUCTURE"></a>
Repository Structure</h1>
<p>The repository comes with the following directories on top level:</p>
<table class="doxtable">
<tr>
<th>Directory </th><th>Description  </th></tr>
<tr>
<td>coIDE </td><td>Sample projects for the coIDE </td></tr>
<tr>
<td>KEIL </td><td>Sample projects for the KEIL IDE </td></tr>
<tr>
<td>Doc </td><td>Documentation </td></tr>
<tr>
<td>src </td><td>Source code </td></tr>
</table>
<p>The most important directory is the 'src' directory:</p>
<table class="doxtable">
<tr>
<th>Directory </th><th>Description  </th></tr>
<tr>
<td>apps </td><td>Application examples </td></tr>
<tr>
<td>boards </td><td>Contains board specific implementations of hardware platform drivers </td></tr>
<tr>
<td>mac </td><td>The LoRaMAC sources </td></tr>
<tr>
<td>peripherals </td><td>This directory contains drivers for peripherals which are available on some hardware platforms </td></tr>
<tr>
<td>radio </td><td>The radio driver implementations </td></tr>
<tr>
<td>system </td><td>Generic abstraction layer for the different hardware platforms </td></tr>
</table>
<hr/>
<h1><a class="anchor" id="PORTING_PLATFORM"></a>
Porting To Another Hardware Platform</h1>
<p>In general, the motivation is to provide a simple and well defined project structure to allow a fast an easy porting to another platform. This project comes with several examples of hardware platforms, e.g. the LoRaMote or the MoteII. The hardware platform implementations are available at the directory 'src/boards'. If you want to add a new hardware platform, you have to perform the following tasks:</p>
<ul style="list-style-type:decimal">
<li>
Add a new directory at 'src/boards' with the specific hardware platform name  </li>
<li>
Implement at least the following drivers respectively files according to your platform:  <ul style="list-style-type:disc">
<li>
board.c/.h  </li>
<li>
gpio-board.c/.h  </li>
<li>
pinName-board.h  </li>
<li>
pinName-ioe.h  </li>
<li>
rtc-board.c/.h  </li>
<li>
spi-board.c/.h  </li>
<li>
sx1272-board.c/.h  </li>
</ul>
</li>
<li>
You may need to adapt the implementations of the generic abstraction layer in directory 'src/system'  </li>
<li>
You may need to add a new standard peripheral library for your platform into the directory 'src/boards/mcu'. This includes the file 'utilities.c'  </li>
</ul>
<hr/>
<h1><a class="anchor" id="RXWINDOWS"></a>
RX Window Calculation</h1>
<p>The RX window calculation is implemented according to chapter 3.1.2 of the following documents:</p>
<p><a href="http://www.semtech.com/images/datasheet/SX1272_settings_for_LoRaWAN_v2.0.pdf">http://www.semtech.com/images/datasheet/SX1272_settings_for_LoRaWAN_v2.0.pdf</a> or <a href="http://www.semtech.com/images/datasheet/SX1276_settings_for_LoRaWAN_v2.0.pdf">http://www.semtech.com/images/datasheet/SX1276_settings_for_LoRaWAN_v2.0.pdf</a></p>
<div class="fragment"><div class="line">                 Downlink start: T = Tx + 1s (+/- 20 us)</div><div class="line">                            |</div><div class="line">             TRxEarly       |        TRxLate</div><div class="line">                |           |           |</div><div class="line">                |           |           +---+---+---+---+---+---+---+---+</div><div class="line">                |           |           |       Latest Rx window        |</div><div class="line">                |           |           +---+---+---+---+---+---+---+---+</div><div class="line">                |           |           |</div><div class="line">                +---+---+---+---+---+---+---+---+</div><div class="line">                |       Earliest Rx window      |</div><div class="line">                +---+---+---+---+---+---+---+---+</div><div class="line">                            |</div><div class="line">                            +---+---+---+---+---+---+---+---+</div><div class="line">Downlink preamble 8 symbols |   |   |   |   |   |   |   |   |</div><div class="line">                            +---+---+---+---+---+---+---+---+</div></div><!-- fragment --><p>TRxLate = DEFAULT_MIN_RX_SYMBOLS * tSymbol - RADIO_WAKEUP_TIME</p>
<p>TRxEarly = 8 - DEFAULT_MIN_RX_SYMBOLS * tSymbol - RxWindowTimeout - RADIO_WAKEUP_TIME</p>
<p>TRxLate - TRxEarly = 2 * DEFAULT_SYSTEM_MAX_RX_ERROR</p>
<p>RxOffset = ( TRxLate + TRxEarly ) / 2</p>
<p>RxWindowTimeout = ( 2 * DEFAULT_MIN_RX_SYMBOLS - 8 ) * tSymbol + 2 * DEFAULT_SYSTEM_MAX_RX_ERROR</p>
<p>RxOffset = 4 * tSymbol - RxWindowTimeout / 2 - RADIO_WAKE_UP_TIME</p>
<p>Minimal value of RxWindowTimeout must be 5 symbols which implies that the system always tolerates at least an error of 1.5 * tSymbol.</p>
<hr/>
<h1><a class="anchor" id="RXWINDOWS_CALIBRATION"></a>
RX Window Calibration</h1>
<p>The LoRaMAC stack supports a runtime calibration of the RX window timing. As described in section <a class="el" href="_p_o_r_t_i_n_g__g_u_i_d_e.html#RXWINDOWS">RX Window Calculation</a>, the RX window timing especially depends on DEFAULT_SYSTEM_MAX_RX_ERROR and DEFAULT_MIN_RX_SYMBOLS. The related MIB types are <a class="el" href="group___l_o_r_a_m_a_c.html#gga64429ce77a29145f6a7508df5eaa2d3ead5d382841f32fba944bdb68b25699e45">MIB_SYSTEM_MAX_RX_ERROR</a> and <a class="el" href="group___l_o_r_a_m_a_c.html#gga64429ce77a29145f6a7508df5eaa2d3ea82fb27fd6414d2bde20a7a00c80e26a1">MIB_MIN_RX_SYMBOLS</a>.</p>
<p>The following code snippet shows how to update those values during runtime:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">  <a class="code" href="group___l_o_r_a_m_a_c.html#struct_mib_request_confirm__t">MibRequestConfirm_t</a> mibReq;</div><div class="line"></div><div class="line">  <span class="comment">// This comment is a placeholder for the initialization of the LoRaMAC layer</span></div><div class="line"></div><div class="line">  <span class="comment">// Update the DEFAULT_SYSTEM_MAX_RX_ERROR</span></div><div class="line">  mibReq.<a class="code" href="group___l_o_r_a_m_a_c.html#ada1f9249fb28125c69bdfacfaeeae0e2">Type</a> = <a class="code" href="group___l_o_r_a_m_a_c.html#gga64429ce77a29145f6a7508df5eaa2d3ead5d382841f32fba944bdb68b25699e45">MIB_SYSTEM_MAX_RX_ERROR</a>;</div><div class="line">  mibReq.<a class="code" href="group___l_o_r_a_m_a_c.html#afb8c77b3200d879d36beed691fb71f8d">Param</a>.<a class="code" href="group___l_o_r_a_m_a_c.html#a62adc341212fe903e9995966051c5fee">SystemMaxRxError</a> = 15;</div><div class="line">  <span class="keywordflow">if</span>( <a class="code" href="group___l_o_r_a_m_a_c.html#ga7a4ee0ced221591206b09630d4a70844">LoRaMacMibSetRequestConfirm</a>( &amp;mibReq ) != <a class="code" href="group___l_o_r_a_m_a_c.html#gga363b63a6d24ca4827c81898ebb1887e9a03db5fca052313edb3823c014b653a74">LORAMAC_STATUS_OK</a> )</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">  <span class="comment">// Update the DEFAULT_MIN_RX_SYMBOLS.</span></div><div class="line">  mibReq.<a class="code" href="group___l_o_r_a_m_a_c.html#ada1f9249fb28125c69bdfacfaeeae0e2">Type</a> = <a class="code" href="group___l_o_r_a_m_a_c.html#gga64429ce77a29145f6a7508df5eaa2d3ea82fb27fd6414d2bde20a7a00c80e26a1">MIB_MIN_RX_SYMBOLS</a>;</div><div class="line">  mibReq.<a class="code" href="group___l_o_r_a_m_a_c.html#afb8c77b3200d879d36beed691fb71f8d">Param</a>.<a class="code" href="group___l_o_r_a_m_a_c.html#ab33f97482f9af163d593cf103a2ccf1c">MinRxSymbols</a> = 8;</div><div class="line">  <span class="keywordflow">if</span>( <a class="code" href="group___l_o_r_a_m_a_c.html#ga7a4ee0ced221591206b09630d4a70844">LoRaMacMibSetRequestConfirm</a>( &amp;mibReq ) != <a class="code" href="group___l_o_r_a_m_a_c.html#gga363b63a6d24ca4827c81898ebb1887e9a03db5fca052313edb3823c014b653a74">LORAMAC_STATUS_OK</a> )</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div></div><!-- fragment --><hr/>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Sep 8 2017 16:02:31 for LoRaMAC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
